# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/dma/ti/kslc-bcdma.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Texas Instruments KSLC DMSS BCDMA Device Tree Bindings

maintainers:
  - Peter Ujfalusi <peter.ujfalusi@ti.com>

description: |
  The Block Copy DMA (BCDMA) is intended to perform similar functions as the TR
  mode channels of K3 UDMA-P.
  BCDMA includes block copy channels and Split channels.
  Bloc copy channels can be used to memory to memory transfers while the split
  channels can be used to serivce PSI-L based peripherals.

  The peripherals serviced by BCDMA can be PSI-L native or legacy, non PSI-L
  native peripherals. In the later case a special, small PDMA is tasked to act
  as a bridge between the PSI-L fabric and the legacy peripheral.

  PDMAs can be configured via BCDMA split channel's peer registers to match with
  the configuration of the legacy peripheral.

allOf:
  - $ref: "../dma-controller.yaml#"

properties:
  "#dma-cells":
    const: 2
    description: |
      The first cell is the PSI-L  thread ID of the remote (to BCDMA) end.
      Valid ranges for thread ID depends on the data movement direction:
      for source thread IDs (rx): 0 - 0x7fff
      for destination thread IDs (tx): 0x8000 - 0xffff

      Please refer to the device documentation for the PSI-L thread map and also
      the PSI-L peripheral chapter for the correct thread ID.

      The second cell is the ASEL value for the channel

  compatible:
    enum:
      - ti,am64-dmss-bcdma

  reg:
    maxItems: 3

  reg-names:
   items:
     - const: gcfg
     - const: bchanrt
     - const: rchanrt
     - const: tchanrt

  msi-parent: true

  ti,sci:
    description: phandle to TI-SCI compatible System controller node
    allOf:
      - $ref: /schemas/types.yaml#/definitions/phandle

  ti,sci-dev-id:
    description: TI-SCI device id of BCDMA
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint32

  ti,ringacc:
    description: phandle to the ring node
    allOf:
      - $ref: /schemas/types.yaml#/definitions/phandle

  ti,sci-rm-range-bchan:
    description: |
      Array of BCDMA block-copy channel resource subtypes for resource
      allocation for this host
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint32-array
    minItems: 1
    # Should be enough
    maxItems: 255

  ti,sci-rm-range-tchan:
    description: |
      Array of BCDMA split tx channel resource subtypes for resource allocation
      for this host
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint32-array
    minItems: 1
    # Should be enough
    maxItems: 255

  ti,sci-rm-range-rchan:
    description: |
      Array of BCDMA split rx channel resource subtypes for resource allocation
      for this host
    allOf:
      - $ref: /schemas/types.yaml#/definitions/uint32-array
    minItems: 1
    # Should be enough
    maxItems: 255

required:
  - compatible
  - "#dma-cells"
  - reg
  - reg-names
  - msi-parent
  - ti,sci
  - ti,sci-dev-id
  - ti,ringacc
  - ti,sci-rm-range-bchan
  - ti,sci-rm-range-tchan
  - ti,sci-rm-range-rchan

additionalProperties: false

examples:
  - |+
    cbass_main {
        #address-cells = <2>;
        #size-cells = <2>;

        main_dmss {
            compatible = "simple-mfd";
            #address-cells = <2>;
            #size-cells = <2>;
            dma-ranges;
            ranges;

            ti,sci-dev-id = <25>;

            main_bcdma: dma-controller@485c0100 {
                compatible = "ti,am64-dmss-bcdma";
                #address-cells = <2>;
                #size-cells = <2>;
                ranges;

                reg = <0x0 0x485c0100 0x0 0x100>,
                      <0x0 0x4c000000 0x0 0x20000>,
                      <0x0 0x4a820000 0x0 0x20000>,
                      <0x0 0x4aa40000 0x0 0x20000>;
                reg-names = "gcfg", "bchanrt", "rchanrt", "tchanrt";
                msi-parent = <&inta_main_dmss>;
                #dma-cells = <2>;

                ti,sci = <&dmsc>;
                ti,sci-dev-id = <26>;
                ti,ringacc = <&bcdma_ring>;

                ti,sci-rm-range-bchan = <0x20>; /* BLOCK_COPY_CHAN */
                ti,sci-rm-range-rchan = <0x21>; /* SPLIT_TR_RX_CHAN */
                ti,sci-rm-range-tchan = <0x22>; /* SPLIT_TR_TX_CHAN */

                bcdma_ring: dmss_ring@4ba00000 {
                    compatible = "ti,am64-dmss-rings";
                    reg = <0x0 0x4bc00000 0x0 0x100000>;
                    reg-names = "rt";
                    ti,num-rings = <68>;
                };
            };
        };
    };
